import matplotlib.pyplot as plt
import numpy as np

def plotGANGeneratorSamples(results, step: int=1):
    genSamples = results["generator_samples"]
    epochs = len(genSamples)
    imgsPerSample = genSamples[0].size(0)

    assert epochs >= step, f"No epochs matched the step={step}. try a smaller step"

    selectedEpochs = [i for i in range(step, epochs+1, step)]
    selectedSamples = [genSamples[i-1] for i in selectedEpochs]
    numCols = len(selectedEpochs)

    # Create a series of subplots
    fig, axs = plt.subplots(nrows=imgsPerSample,
                            ncols=numCols,
                            figsize=(epochs, imgsPerSample)
                            )
    
    for col, genSample in enumerate(selectedSamples):
        genSample = genSample.detach().cpu()

        # permute samples from BCHW -> BHWC (make matplotlib friendly)
        permutedSample = genSample.permute(0,2,3,1)
        for sampleIdx, img in enumerate(permutedSample):
            img = img.numpy()
            img = (img - img.min()) / (img.max() - img.min())

            ax = axs[sampleIdx, col]
            ax.imshow(img.squeeze(), cmap="gray" if img.shape[-1]==1 else None)
            ax.axis("off")

    bigAx = fig.add_subplot(111, frameon=False)
    bigAx.set_xticks(np.arange(numCols) + 0.5)
    # bigAx.set_yticks(np.arange(imgsPerSample))

    bigAx.set_xticklabels([f"{e}" for e in selectedEpochs])
    # bigAx.set_yticklabels([f"{i}" for i in range(imgsPerSample)])

    bigAx.set_xlabel("Epoch")
    bigAx.set_ylabel("Latent Sample")
    bigAx.tick_params(labelcolor='black', top=False, bottom=False, left=False, right=False)

    fig.suptitle(f"Images Generated by GAN", fontsize=16)
    
    plt.tight_layout(rect=(0, 0, 1, 0.95))
    plt.show()